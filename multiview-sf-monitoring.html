<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>SF ESTT Monitoring - Kaltura</title>

    <link rel="icon" href="https://www.kaltura.com/favicon.ico" sizes="any" />
    <link
      rel="shortcut icon"
      href="https://www.kaltura.com/favicon.ico"
      type="image/x-icon"
    />
    <link rel="apple-touch-icon" href="https://www.kaltura.com/favicon.ico" />

    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/video.js@8/dist/video-js.min.css"
      rel="stylesheet"
    />

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: { kaltura: { blue: "#1e88e5" } },
          },
        },
      };
    </script>

    <script>
      // **********************************************
      // Video.js sources for the two players to update
      // **********************************************
      const video_js_source_primary =
        "https://cdnapi.kaltura.com/p/5677832/sp/567783200/playManifest/entryId/1_if2bxu3i/protocol/https/format/applehttp/streamType/0/a.m3u8";
      const video_js_source_secondary =
        "https://cdnapi.kaltura.com/p/5677832/sp/567783200/playManifest/entryId/1_if2bxu3i/protocol/https/format/applehttp/streamType/1/a.m3u8";
    </script>

    <style>
      html.auth-pending body > .app-root {
        display: none;
      }
    </style>
  </head>
  <body class="min-h-screen bg-gray-50 text-gray-900">
    <noscript>
      <div class="p-4 bg-red-100 text-red-800 text-center">
        This page requires JavaScript for the password screen and layout.
      </div>
    </noscript>

    <div id="auth-overlay" class="fixed inset-0 z-50 hidden">
      <div
        class="w-full h-full bg-gray-900/70 flex items-center justify-center p-4"
      >
        <div class="w-full max-w-sm bg-white rounded-2xl shadow-xl">
          <div class="p-6 space-y-4">
            <div class="flex items-center gap-3">
              <div
                class="h-10 w-10 rounded-full bg-kaltura-blue/10 flex items-center justify-center"
              >
                <img
                  src="https://www.kaltura.com/favicon.ico"
                  alt="Kaltura logo"
                  class="h-7 w-7"
                />
              </div>
              <h1 class="text-xl font-semibold">SF ESTT Monitoring</h1>
            </div>

            <p class="text-sm text-gray-600">
              Enter the password to view the dashboard.
            </p>

            <form id="auth-form" class="space-y-3">
              <label class="block text-sm font-medium">Password</label>
              <input
                id="auth-password"
                type="password"
                class="w-full rounded-xl border border-gray-300 px-3 py-2 focus:outline-none focus:ring-2 focus:ring-kaltura-blue"
                placeholder="••••••••"
                autocomplete="current-password"
              />
              <button
                class="w-full rounded-xl bg-kaltura-blue text-white px-3 py-2 font-medium hover:opacity-90 transition"
              >
                Unlock
              </button>
              <p id="auth-error" class="text-sm text-red-600 hidden">
                Incorrect password. Try again.
              </p>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="app-root flex flex-col min-h-screen">
      <header
        class="sticky top-0 z-10 bg-white/90 backdrop-blur border-b border-gray-200"
      >
        <div
          class="mx-auto max-w-7xl px-4 py-3 flex items-center justify-between"
        >
          <div class="flex items-center gap-3">
            <div
              class="h-10 w-10 rounded-full bg-kaltura-blue/10 flex items-center justify-center"
            >
              <img
                src="https://www.kaltura.com/favicon.ico"
                alt="Kaltura logo"
                class="h-7 w-7"
              />
            </div>
            <div class="leading-tight">
              <div class="text-lg font-semibold">SF ESTT Monitoring</div>
              <div class="text-xs text-gray-500">Kaltura</div>
            </div>
          </div>

          <div class="flex items-center gap-2">
            <button
              id="logout-btn"
              class="text-sm px-3 py-1.5 rounded-lg border border-gray-300 hover:bg-gray-100"
            >
              Lock
            </button>
          </div>
        </div>
      </header>

      <main class="flex-1">
        <div class="mx-auto max-w-7xl p-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 auto-rows-fr">
            <section
              id="cell-1"
              class="bg-white rounded-2xl shadow p-3 flex flex-col"
            >
              <h2 class="text-sm font-medium text-gray-600 mb-2">
                Kaltura Player (Standalone)
              </h2>
              <div
                class="flex-1 rounded-lg bg-gray-100 flex items-center justify-center text-gray-400"
              >
                <!-- Kaltura iframe tag -->
                <iframe
                  type="text/javascript"
                  src="https://cdnapisec.kaltura.com/p/5677832/embedPlaykitJs/uiconf_id/57279352?iframeembed=true&entry_id=1_if2bxu3i"
                  style="width: 560px; height: 395px"
                  allowfullscreen
                  webkitallowfullscreen
                  mozAllowFullScreen
                  allow="autoplay *; fullscreen *; encrypted-media *"
                  frameborder="0"
                  title="Test2"
                ></iframe>
              </div>
            </section>

            <section
              id="cell-2"
              class="bg-white rounded-2xl shadow p-3 flex flex-col"
            >
              <h2 class="text-sm font-medium text-gray-600 mb-2">
                Kaltura Player (SF+)
              </h2>
              <div
                class="flex-1 rounded-lg bg-gray-100 flex items-center justify-center text-gray-400"
              >
                <!-- SF+, VDO.Ninja iframe tag -->
                <span>Add iframe embed</span>
              </div>
            </section>

            <section
              id="cell-3"
              class="bg-white rounded-2xl shadow p-3 flex flex-col"
            >
              <h2 class="text-sm font-medium text-gray-600 mb-2">
                Video.js from Primary Manifest
              </h2>
              <div
                class="flex-1 rounded-lg bg-gray-100 flex items-center justify-center text-gray-400"
              >
                <video
                  id="playerA"
                  class="video-js vjs-default-skin vjs-16-9"
                  controls
                  preload="auto"
                  playsinline
                  muted
                ></video>
              </div>
            </section>

            <section
              id="cell-4"
              class="bg-white rounded-2xl shadow p-3 flex flex-col"
            >
              <h2 class="text-sm font-medium text-gray-600 mb-2">
                Video.js from Backup Manifest
              </h2>
              <div
                class="flex-1 rounded-lg bg-gray-100 flex items-center justify-center text-gray-400"
              >
                <video
                  id="playerB"
                  class="video-js vjs-default-skin vjs-16-9"
                  controls
                  preload="auto"
                  playsinline
                  muted
                ></video>
              </div>
            </section>
          </div>
        </div>
      </main>

      <footer class="border-t border-gray-200 bg-white">
        <div
          class="mx-auto max-w-7xl px-4 py-6 text-sm text-gray-600 flex items-center justify-between"
        >
          <span
            >&copy; <span id="year"></span> Kaltura. All rights reserved.</span
          >
        </div>
      </footer>
    </div>

    <script>
      const EXPECTED_HASH_HEX =
        "057c3fa038d5215ce11fe9ccc77a7583a67fc518ca7bd4de7955032da308f5ff";

      const STORAGE_KEY = "sf-estt-auth";
      const authOverlay = document.getElementById("auth-overlay");
      const authForm = document.getElementById("auth-form");
      const authInput = document.getElementById("auth-password");
      const authError = document.getElementById("auth-error");
      const logoutBtn = document.getElementById("logout-btn");

      function toHex(buf) {
        return Array.from(new Uint8Array(buf))
          .map((b) => b.toString(16).padStart(2, "0"))
          .join("");
      }

      async function sha256Hex(str) {
        const enc = new TextEncoder();
        const buf = await crypto.subtle.digest("SHA-256", enc.encode(str));
        return toHex(buf);
      }

      function showOverlay() {
        document.documentElement.classList.add("auth-pending");
        authOverlay.classList.remove("hidden");
        setTimeout(() => authInput?.focus(), 50);
      }

      function hideOverlay() {
        document.documentElement.classList.remove("auth-pending");
        authOverlay.classList.add("hidden");
      }

      (function initAuth() {
        const token = localStorage.getItem(STORAGE_KEY);
        if (token === EXPECTED_HASH_HEX) {
          hideOverlay();
        } else {
          showOverlay();
        }
      })();

      authForm?.addEventListener("submit", async (e) => {
        e.preventDefault();
        authError.classList.add("hidden");
        const entered = authInput.value || "";
        const enteredHash = await sha256Hex(entered);
        if (enteredHash === EXPECTED_HASH_HEX) {
          localStorage.setItem(STORAGE_KEY, EXPECTED_HASH_HEX);
          hideOverlay();
          authInput.value = "";
        } else {
          authError.classList.remove("hidden");
          authInput.select();
          authInput.focus();
        }
      });

      logoutBtn?.addEventListener("click", () => {
        localStorage.removeItem(STORAGE_KEY);
        showOverlay();
      });

      document.getElementById("year").textContent = new Date().getFullYear();
      document.getElementById("scroll-top")?.addEventListener("click", (e) => {
        e.preventDefault();
        window.scrollTo({ top: 0, behavior: "smooth" });
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/video.js@8/dist/video.min.js"></script>
    <script>
      const baseOpts = {
        fluid: true,
        liveui: true,
        html5: {
          vhs: {
            overrideNative: true,
            lowLatencyMode: true,
          },
        },
        controlBar: {
          pictureInPictureToggle: true,
          volumePanel: { inline: false },
        },
      };

      const playerA = videojs("playerA", baseOpts);
      const playerB = videojs("playerB", baseOpts);

      playerA.src({
        src: video_js_source_primary,
        type: "application/x-mpegURL",
      });
      playerB.src({
        src: video_js_source_secondary,
        type: "application/x-mpegURL",
      });

      [playerA, playerB].forEach((p) => p.play().catch(() => {}));

      [playerA, playerB].forEach((p) => {
        p.on("error", () => {
          const err = p.error();
          console.error("Video.js error:", err);
        });
      });
    </script>
  </body>
</html>
